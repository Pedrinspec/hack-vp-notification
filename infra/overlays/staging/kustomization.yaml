apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Referencia o base (infra/)
resources:
- ../../

# Namespace de staging
namespace: notification-staging

# Labels adicionais para identificar o ambiente
commonLabels:
  environment: staging

# Réplicas para staging (HA mínimo)
replicas:
- name: hack-notification-service
  count: 2

# Tag da imagem para staging
images:
- name: hack-notification-service
  newTag: staging-latest

# Patches de configuração específicos do ambiente
patches:
- path: configmap-patch.yaml
  target:
    kind: ConfigMap
    name: hack-notification-config

# ConfigMap de staging
configMapGenerator:
- name: hack-notification-env-config
  behavior: merge
  literals:
  - SPRING_PROFILES_ACTIVE=staging
  - LOGGING_LEVEL_COM_FIAP_HACKNOTIFICATION=INFO
  - MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE=health,info,metrics,prometheus
